<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>T Play</title>
<link rel="icon" href="https://i.postimg.cc/RCnCv14W/T-Play.png" type="image/png" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  :root {
    --primary-color: #e50914;
    --primary-gradient: linear-gradient(135deg, #e50914 0%, #b80710 100%);
    --secondary-color: #0071eb;
    --dark-bg: #0f0f13;
    --light-bg: #1a1a23;
    --card-bg: #1e1e29;
    --text-color: #ffffff;
    --text-secondary: #a0a0b0;
    --header-height: 70px;
    --player-aspect: 9/16;
    --transition: all 0.3s ease;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  body {
    background-color: var(--dark-bg);
    color: var(--text-color);
    line-height: 1.6;
    overflow-x: hidden;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  img {
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
  }

  .mobile-header {
    display: none;
  }

  .mobile-nav {
    display: none;
  }

  .main-content {
    display: flex;
    margin-top: 0;
    min-height: 100vh;
  }

  .player-section {
    flex: 1;
    padding: 0;
    display: flex;
    flex-direction: column;
    max-width: 100%;
  }

  .video-container {
    position: relative;
    width: 100%;
    height: 270px;
    padding-bottom: 56.25%;
    background: #000;
    border-radius: 0px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }

  #liveVideo {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: fill;
  }

  #posterImage {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
  }

  #loadingOverlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    color: var(--primary-color);
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9;
    flex-direction: column;
    gap: 15px;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 3px solid rgba(229, 9, 20, 0.3);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .channel-info {
    display: none;
  }

  .controls {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 15px;
    border-radius: 30px;
    z-index: 10;
    opacity: 0;
    transition: var(--transition);
    backdrop-filter: blur(5px);
    align-items: center;
  }

  .video-container:hover .controls {
    opacity: 1;
  }

  .control-btn, .mute-btn {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    font-size: 14px;
  }

  .control-btn:hover, .mute-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
  }

  .nav-btn {
    width: 80px;
    height: 240px;
    background: var(--primary-gradient);
    color: white;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    font-size: 16px;
  }

  .nav-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 5px 15px rgba(229, 9, 20, 0.4);
  }

  .channel-nav {
    display: flex;
    gap: 10px;
    margin-top: 15px;
  }

  .quality-select {
    border-radius: 20px;
    padding: 6px 12px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    font-size: 13px;
    cursor: pointer;
    backdrop-filter: blur(5px);
  }

  .source-select {
    border-radius: 20px;
    padding: 6px 12px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    font-size: 13px;
    cursor: pointer;
    backdrop-filter: blur(5px);
    max-width: 120px;
  }

  .volume-container {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .volume-slider {
    width: 70px;
    -webkit-appearance: none;
    height: 4px;
    border-radius: 2px;
    background: rgba(255, 255, 255, 0.3);
    outline: none;
  }

  .volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
  }

  .volume-slider::-moz-range-thumb {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
  }

  .channels-sidebar {
    width: 30%;
    max-width: 400px;
    background: var(--light-bg);
    padding: 25px 20px;
    overflow-y: auto;
    border-left: 1px solid rgba(255, 255, 255, 0.05);
    height: calc(100vh - 60px);
    position: sticky;
    top: 20px;
    border-radius: 16px 0 0 16px;
    margin: 10px 0 10px 10px;
    scrollbar-width: thin;
    scrollbar-color: var(--primary-color) rgba(255, 255, 255, 0.05);
  }

  .channels-sidebar::-webkit-scrollbar {
    width: 8px;
  }

  .channels-sidebar::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    margin: 3px;
  }

  .channels-sidebar::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
    background-clip: padding-box;
  }

  .category-bar {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    gap: 10px;
    padding: 20px 0;
    align-items: center;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .category-bar::-webkit-scrollbar {
    display: none;
  }

  .category-bar button {
    background: var(--card-bg);
    color: var(--text-secondary);
    border: none;
    padding: 10px 20px;
    border-radius: 30px;
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
    flex-shrink: 0;
  }

  .category-bar button.active {
    background: var(--primary-gradient);
    color: white;
  }

  /* New styles for language filter bar */
  .language-filter-container {
    padding: 10px 0;
  }

  .language-bar {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    gap: 8px;
    padding: 10px 0;
    align-items: center;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .language-bar::-webkit-scrollbar {
    display: none;
  }

  .filter-btn {
    background: var(--card-bg);
    color: var(--text-secondary);
    border: none;
    padding: 8px 16px;
    border-radius: 30px;
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
    flex-shrink: 0;
  }

  .filter-btn.active {
    background: var(--primary-gradient);
    color: white;
  }

  /* Rest of your styles... */
</style>
</head>
<body>
<div class="protection-overlay" id="protectionOverlay"></div>

<div class="mobile-header"></div>

<div class="mobile-nav" id="mobileNav"></div>

<div class="main-content">
  <section class="player-section">
    <div class="video-container">
      <img id="posterImage" src="https://i.postimg.cc/Pr9sC68t/T-Play-Cover.jpg" alt="T Play Poster" />
      <div id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div>Loading...</div>
      </div>
      <video id="liveVideo" playsinline webkit-playsinline></video>
      <p id="status">Wake Lock Status: Inactive</p>
      <div class="controls">
        <button class="nav-btn" onclick="prevChannel()" title="Previous Channel"><i class="fas fa-chevron-left"></i></button>
        <button class="control-btn" onclick="togglePlayPause()" id="playPauseBtn" title="Play/Pause"><i class="fas fa-pause"></i></button>
        <button class="control-btn" onclick="cycleZoom()" title="Change View"><i class="fas fa-expand-alt"></i></button>
        <button class="control-btn" onclick="toggleFullscreen()" title="Fullscreen"><i class="fas fa-expand"></i></button>
        <button class="control-btn ios-fullscreen-btn" onclick="requestFullscreen()" title="Fullscreen (iOS)"><i class="fas fa-expand"></i></button>
        <button class="control-btn" onclick="togglePiP()" title="Picture-in-Picture"><i class="fas fa-tv"></i></button>
        <div class="volume-container">
          <button class="mute-btn" onclick="toggleMute()" id="muteBtn" title="Mute"><i class="fas fa-volume-up"></i></button>
          <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1" />
        </div>
        <button class="nav-btn" onclick="nextChannel()" title="Next Channel"><i class="fas fa-chevron-right"></i></button>
        <select class="source-select" id="sourceMenu">
          <option value="0">Main Source</option>
        </select>
        <select class="quality-select" id="qualityMenu">
          <option value="auto">Auto Quality</option>
        </select>
      </div>
    </div>
    <div class="error-message" id="errorMessage">
      <p><i class="fas fa-exclamation-triangle"></i> <span id="errorText">Channel failed to load. Please try another channel.</span></p>
    </div>
  </section>

  <!-- Category Bar -->
  <div class="category-bar">
    <button class="active" onclick="filterCategory('all', event)">All</button>
    <button onclick="filterCategory('News', event)">News</button>
    <button onclick="filterCategory('Kids', event)">Kids</button>
    <button onclick="filterCategory('Music', event)">Music</button>
    <button onclick="filterCategory('Movie', event)">Movie</button>
    <button onclick="filterCategory('Entertainment', event)">Entertainment</button>
    <button onclick="filterCategory('Sports', event)">Sports</button>
    <button onclick="filterCategory('Infotainment', event)">Infotainment</button>
    <button onclick="filterCategory('Religious', event)">Religious</button>
  </div>

  <!-- Language Filter -->
  <div class="language-filter-container">
    <div class="language-bar" id="languageBar">
      <button class="filter-btn active" data-language="all">All Languages</button>
      <!-- Language buttons will be dynamically added here -->
    </div>
  </div>

  <!-- Channel list -->
  <div class="channel-list" id="channelList"></div>
</div>

<!-- Include HLS.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  // Protection code omitted for brevity, keep your protection code here...

  // Your channel data (add your full array here)
  const channels = [
    { 
      name: "Manorama News", 
      sources: [
        { name: "Server 1", url: "https://mmtvnews1.akamaized.net/v1/master/673630b269b766886555eebfddd4f27f3de3ab50/mmtvNewsCampaign1/index.m3u8" },
        { name: "Server 2", url: "https://segment.yuppcdn.net/240122/manoramanews/playlist.m3u8" }
      ], 
      img: "https://i.ibb.co/RppPy0m5/manoramanews.jpg", 
      category: "News",
      description: "Malayalam",
      languages: ["Malayalam"]
    },
    { 
      name: "Janam TV", 
      sources: [
        { name: "Server 1", url: "https://segment.yuppcdn.net/140622/janamtvdev/playlist.m3u8" },
        { name: "Server 2", url: "https://tplay.live/out/news/jamuna-tv/index.m3u8" }
      ], 
      img: "https://i.ibb.co/DPh3zcbV/janamtv.jpg", 
      category: "News",
      description: "Malayalam",
      languages: ["Malayalam"]
    },
    { 
      name: "Colors", 
      sources: [
        { name: "Server 1", url: "go:S1043" },
        { name: "Server 2", url: "go:S1041" },
        { name: "Server 3", url: "go:S1042" }
      ], 
      img: "https://i.postimg.cc/5tddWJPd/colors.jpg", 
      category: "Entertainment",
      description: "India",
      languages: ["Malayalam"]
    },
    // Add your other channels here, making sure to include the 'languages' array
  ];

  let currentCategory = 'all';
  let currentLanguage = 'all';

  // Populate language filters based on channels' 'languages' array
  function populateLanguageFilters() {
    const languageBar = document.getElementById('languageBar');
    // Collect all unique languages
    const languageSet = new Set();

    channels.forEach(channel => {
      if (channel.languages && Array.isArray(channel.languages)) {
        channel.languages.forEach(lang => {
          if (lang && lang.trim() !== "") {
            languageSet.add(lang);
          }
        });
      }
    });

    // Remove existing language buttons except the 'all' button
    document.querySelectorAll('.language-bar .filter-btn').forEach(btn => {
      if (btn.getAttribute('data-language') !== 'all') {
        btn.remove();
      }
    });

    // Ensure "All" button exists and is active
    let allBtn = document.querySelector('.language-bar .filter-btn[data-language="all"]');
    if (!allBtn) {
      allBtn = document.createElement('button');
      allBtn.className = 'filter-btn active';
      allBtn.setAttribute('data-language', 'all');
      allBtn.textContent = 'All Languages';
      allBtn.addEventListener('click', () => {
        document.querySelectorAll('.language-bar .filter-btn').forEach(b => b.classList.remove('active'));
        allBtn.classList.add('active');
        currentLanguage = 'all';
        loadChannels();
      });
      document.querySelector('.language-bar').appendChild(allBtn);
    } else {
      allBtn.classList.add('active');
    }

    // Add buttons for each language
    Array.from(languageSet).sort().forEach(lang => {
      const btn = document.createElement('button');
      btn.className = 'filter-btn';
      btn.setAttribute('data-language', lang);
      btn.textContent = lang;
      btn.addEventListener('click', () => {
        document.querySelectorAll('.language-bar .filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentLanguage = lang;
        loadChannels();
      });
      document.querySelector('.language-bar').appendChild(btn);
    });
  }

  // Load channels based on category & language
  function loadChannels() {
    document.getElementById('channelList').innerHTML = '';
    // Filter channels
    const filtered = channels.filter(channel => {
      const matchesCategory = (currentCategory === 'all' || channel.category === currentCategory);
      const matchesLanguage = (currentLanguage === 'all' || (channel.languages && channel.languages.includes(currentLanguage)));
      return matchesCategory && matchesLanguage;
    });
    document.getElementById('channelCount').textContent = `${filtered.length} channels`;
    // Populate channels
    filtered.forEach((channel, index) => {
      const div = document.createElement('div');
      div.className = 'channel-item';
      div.setAttribute('data-category', channel.category);
      div.setAttribute('data-language', channel.languages.join(', '));
      div.innerHTML = `
        <div class="channel-item-img">
          <img src="${channel.img}" alt="${channel.name}">
          <span class="channel-item-live">LIVE</span>
        </div>
      `;
      div.title = channel.name;
      div.onclick = () => {
        loadChannel(index);
      };
      document.getElementById('channelList').appendChild(div);
    });
    // Save filtered channels for navigation
    filteredChannels = filtered;
  }

  function filterCategory(cat, event) {
    document.querySelectorAll('.category-bar button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    currentCategory = cat;
    loadChannels();
  }

  // The rest of your functions (loadChannel, loadSource, tryNextBackup, showError, etc.) remain unchanged.
  // For brevity, they are omitted here, but ensure they are included from your previous code.

  // Initialization
  window.onload = () => {
    populateLanguageFilters();
    loadChannels();
    if (channels.length > 0) loadChannel(0);
    initPlayer();
  };

  // Rest of your JS functions for controls, error handling, etc. (see previous code)
  // ...
</script>
</body>
</html>
